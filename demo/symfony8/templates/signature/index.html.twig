{#
  Demo signature page. Renders SignaturePageType with form_theme for SignatureCoordinatesType.
  Variables: form, page_title (optional), config_explanation (optional).
#}
{% extends 'base.html.twig' %}

{% block title %}{{ page_title|default('Demo form') }} - PdfSignable Demo{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    #pdf-viewer-container { position: relative; overflow: auto; max-height: 75vh; min-height: 400px; border: 1px solid #dee2e6; border-radius: 0.375rem; background: #f8f9fa; padding: 0.5rem; scrollbar-gutter: auto; }
    #pdf-canvas-wrapper { position: relative; display: block; width: 100%; }
    #pdf-canvas-wrapper canvas { display: block; cursor: crosshair; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .pdf-page-wrapper { position: relative; display: inline-block; margin-bottom: 10px; }
    .signature-overlays { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .signature-overlays .signature-box-overlay { pointer-events: auto; }
    .signature-box-overlay { position: absolute; border: 2px solid var(--box-color, rgba(13, 110, 253, 0.8)); background: var(--box-bg, rgba(13, 110, 253, 0.12)); box-sizing: border-box; font-size: 10px; color: var(--box-color, #0d6efd); overflow: hidden; cursor: move; user-select: none; }
    .signature-box-overlay.dragging { z-index: 10; opacity: 0.9; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .signature-box-overlay .overlay-label { padding: 2px 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .signature-box-overlay .resize-handle { position: absolute; width: 12px; height: 12px; background: var(--box-color, rgba(13, 110, 253, 0.9)); border: 1px solid #fff; border-radius: 3px; pointer-events: auto; z-index: 1; }
    .signature-box-overlay .resize-handle.nw { top: -6px; left: -6px; cursor: nwse-resize; }
    .signature-box-overlay .resize-handle.ne { top: -6px; right: -6px; cursor: nesw-resize; }
    .signature-box-overlay .resize-handle.sw { bottom: -6px; left: -6px; cursor: nesw-resize; }
    .signature-box-overlay .resize-handle.se { bottom: -6px; right: -6px; cursor: nwse-resize; }
    .signature-box-item { border: 1px solid #dee2e6; padding: 1rem; margin-bottom: 0.75rem; border-radius: 0.375rem; background: #fff; }
    #signature-boxes-list { max-height: 50vh; overflow-y: auto; }
  </style>
{% endblock %}

{% block body %}
  <h2 class="mb-3">{{ page_title|default('Signature coordinates demo') }}</h2>
  {% if config_explanation is defined and config_explanation %}
  <div class="card border-primary mb-4">
    <div class="card-header bg-primary bg-opacity-10 text-primary fw-semibold">Configuration</div>
    <div class="card-body">
      <div class="card-text mb-0">{{ config_explanation|raw }}</div>
    </div>
  </div>
  {% endif %}
  <div class="container-fluid">
    {% if form.signatureCoordinates is defined %}
      {# Dump here so it appears in the profiler (dumps inside bundle form theme may not) #}
      {#{% dump form.signatureCoordinates.vars.signature_coordinates_options %}#}
    {% endif %}
    {% form_theme form '@NowoPdfSignable/form/theme.html.twig' %}
    {{ form_start(form, { attr: { id: 'signatureForm' } }) }}
    {% if form.vars.submitted and not form.vars.valid %}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>There are errors in the form. Please correct the fields marked below.</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        {% if form.vars.errors|length > 0 %}
          <div class="mt-2">{{ form_errors(form) }}</div>
        {% endif %}
        {% if form.signatureCoordinates is defined and form.signatureCoordinates.vars.errors|length > 0 %}
          <div class="mt-2">{{ form_errors(form.signatureCoordinates) }}</div>
        {% endif %}
      </div>
    {% endif %}
    {{ form_widget(form) }}
    {{ form_end(form) }}
  </div>
{% endblock %}
