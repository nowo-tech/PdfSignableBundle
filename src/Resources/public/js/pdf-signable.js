(function(){"use strict";const qe={pt:1,mm:.35277777777777775,cm:.035277777777777776,in:.013888888888888888,px:1.3333333333333333};function k(v,G){return v*(qe[G]??1)}function X(v,G){return v/(qe[G]??1)}function We(v){return String(v).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const Ue=220,Ve=37,ze=65,je=48;function Ke(v,G,E){v=v%360,v<0&&(v+=360);const x=G/100,$=E/100,W=(1-Math.abs(2*$-1))*x,V=W*(1-Math.abs(v/60%2-1)),ge=$-W/2;let q=0,le=0,ie=0;v<60?(q=W,le=V):v<120?(q=V,le=W):v<180?(le=W,ie=V):v<240?(le=V,ie=W):v<300?(q=V,ie=W):(q=W,ie=V);const J=Q=>{const ce=Math.round((Q+ge)*255);return(ce<16?"0":"")+Math.min(255,Math.max(0,ce)).toString(16)};return"#"+J(q)+J(le)+J(ie)}function Ge(v){const G=(Ue+v*Ve)%360,E=Ke(G,ze,je),x=parseInt(E.slice(1,3),16),$=parseInt(E.slice(3,5),16),W=parseInt(E.slice(5,7),16);return{border:E,background:`rgba(${x}, ${$}, ${W}, 0.15)`,color:E,handle:E}}function Je(){console.log("[PdfSignable] Script loaded");const v=window.NowoPdfSignableConfig;if(!v){console.warn("[PdfSignable] NowoPdfSignableConfig not found, skipping init");return}const{proxyUrl:G,strings:E}=v,x=document.querySelector(".nowo-pdf-signable-widget"),$=x==null?void 0:x.closest("form");if(!$){console.warn("[PdfSignable] .nowo-pdf-signable-widget or form not found, skipping init");return}const W=(x==null?void 0:x.dataset.preventBoxOverlap)==="1",V=(x==null?void 0:x.dataset.enableRotation)==="1";let ge={};try{const e=(x==null?void 0:x.dataset.boxDefaultsByName)??"{}";ge=typeof e=="string"?JSON.parse(e):{}}catch{ge={}}const q=Math.max(0,parseFloat((x==null?void 0:x.dataset.snapGrid)??"0")||0),le=(x==null?void 0:x.dataset.snapToBoxes)==="1",ie=10;console.log("[PdfSignable] Initialized");const J=$.querySelector(".pdf-url-input"),Q=document.getElementById("loadPdfBtn"),ce=document.getElementById("pdf-placeholder"),Le=document.getElementById("pdf-canvas-wrapper"),Ie=document.getElementById("signature-boxes-list"),ne=document.getElementById("addBoxBtn"),he=$.querySelector(".unit-selector"),ye=$.querySelector(".origin-selector"),D=document.getElementById("pdf-viewer-container");if(!Le||!Ie)return;const L=Le,f=Ie;let ue=1,oe={x:0,y:0},F=null;function Qe(){F||!D||(F=document.createElement("div"),F.id="pdf-touch-wrapper",F.style.transformOrigin="0 0",F.style.transform=`translate(${oe.x}px, ${oe.y}px) scale(${ue})`,D.insertBefore(F,L),F.appendChild(L),Ze())}function Ze(){if(!F)return;let e=0,t=1,n={x:0,y:0},r=0,o=0;F.addEventListener("touchstart",a=>{if(a.touches.length===2){a.preventDefault();const s=a.touches[0],u=a.touches[1];e=Math.hypot(u.clientX-s.clientX,u.clientY-s.clientY),t=ue,n={...oe},r=(s.clientX+u.clientX)/2,o=(s.clientY+u.clientY)/2}},{passive:!1}),F.addEventListener("touchmove",a=>{if(a.touches.length===2&&F){a.preventDefault();const s=a.touches[0],u=a.touches[1],c=Math.hypot(u.clientX-s.clientX,u.clientY-s.clientY),l=Math.max(.25,Math.min(4,t*c/e)),i=(s.clientX+u.clientX)/2,d=(s.clientY+u.clientY)/2;oe.x=n.x+(i-r),oe.y=n.y+(d-o),ue=l,F.style.transform=`translate(${oe.x}px, ${oe.y}px) scale(${ue})`}},{passive:!1})}function Z(){return(he==null?void 0:he.value)??"mm"}function me(){return(ye==null?void 0:ye.value)??"bottom_left"}function Ee(e,t,n,r,o,a){const s=e.scale||1.5,u=e.width/s,c=e.height/s;let l,i;switch(a){case"top_left":l=t,i=c-n-o;break;case"top_right":l=u-t-r,i=c-n-o;break;case"bottom_right":l=u-t-r,i=n;break;default:l=t,i=n;break}return{vpX:l*s,vpY:e.height-(i+o)*s}}function Pe(e,t,n,r,o,a){const s=e.scale||1.5,u=e.width/s,c=e.height/s,l=e.convertToPdfPoint(t,n+o*s),i=l[0],d=l[1];let p,g;switch(a){case"top_left":p=i,g=c-d-o;break;case"top_right":p=u-i-r,g=c-d-o;break;case"bottom_right":p=u-i-r,g=d;break;default:p=i,g=d;break}return{xPt:p,yPt:g}}let z=null;const H={};let se=null,Me=!1;function et(e){try{return new URL(e,window.location.origin).origin===window.location.origin?e:G+"?url="+encodeURIComponent(e)}catch{return G+"?url="+encodeURIComponent(e)}}async function Be(){if(!z||!D)return 1.5;const t=(await z.getPage(1)).getViewport({scale:1}),n=D.clientWidth-24;return n<=0?1.5:Math.max(.5,n/t.width)}async function Fe(){var r;const e=((r=J==null?void 0:J.value)==null?void 0:r.trim())??"";if(!e){console.warn("[PdfSignable] Load PDF: URL required"),alert(E.alert_url_required);return}const t=et(e);console.log("[PdfSignable] Loading PDF",{url:e,viaProxy:t!==e}),Q&&(Q.setAttribute("disabled",""),Q.innerHTML='<span class="spinner-border spinner-border-sm me-1"></span> '+E.loading_state),ce&&(ce.style.display="block"),L.style.display="none",L.innerHTML="",ue=1,oe={x:0,y:0},F&&(F.style.transform="translate(0px, 0px) scale(1)");const n=document.createElement("div");n.className="pdf-signable-loading-overlay",n.setAttribute("aria-live","polite"),n.setAttribute("aria-busy","true"),n.innerHTML='<div class="text-center"><div class="spinner-border text-primary mb-2" role="status"><span class="visually-hidden">'+E.loading_state+'</span></div><p class="text-muted small mb-0">'+E.loading_state+"</p></div>",D&&D.appendChild(n);try{z=await pdfjsLib.getDocument(t).promise,Object.keys(H).forEach(s=>delete H[Number(s)]);const o=await Be();for(let s=1;s<=z.numPages;s++){se&&await se;const u=await z.getPage(s),c=u.getViewport({scale:o});H[s]=c;const l=document.createElement("div");l.className="pdf-page-wrapper",l.dataset.page=String(s);const i=document.createElement("canvas"),d=i.getContext("2d");if(!d)continue;i.height=c.height,i.width=c.width,i.dataset.page=String(s);const p=document.createElement("div");p.className="signature-overlays",l.appendChild(i),l.appendChild(p),se=u.render({canvasContext:d,viewport:c}).promise,await se,L.appendChild(l)}ce&&(ce.style.display="none"),L.style.display="block",Qe(),requestAnimationFrame(()=>{_(),setTimeout(_,100),setTimeout(_,350),setTimeout(_,700)}),console.log("[PdfSignable] PDF loaded",{pages:z.numPages,scale:o})}catch(o){console.error("[PdfSignable] PDF load failed",o),alert(E.error_load_pdf+(o instanceof Error?o.message:String(o)))}finally{n.remove(),Q&&(Q.removeAttribute("disabled"),Q.innerHTML=E.load_pdf_btn)}}function _(){if(Me||Object.keys(H).length===0)return;const e=Z(),t=me();L.querySelectorAll(".signature-overlays").forEach(s=>{s.innerHTML=""});const n=f.querySelectorAll(":scope > .signature-box-item"),r={},o={};let a=0;if(n.forEach((s,u)=>{var re,de,fe,T,pe;const c=parseInt(((re=s.querySelector(".signature-box-page"))==null?void 0:re.value)??"1",10),l=parseFloat(((de=s.querySelector(".signature-box-x"))==null?void 0:de.value)??"0"),i=parseFloat(((fe=s.querySelector(".signature-box-y"))==null?void 0:fe.value)??"0"),d=parseFloat(((T=s.querySelector(".signature-box-width"))==null?void 0:T.value)??"150"),p=parseFloat(((pe=s.querySelector(".signature-box-height"))==null?void 0:pe.value)??"40"),g=s.querySelector(".signature-box-angle"),h=V&&g?parseFloat(g.value??"0"):0,A=s.querySelector(".signature-box-name"),b=((A==null?void 0:A.value)??"").trim(),I=b===""?"__empty__":b;I in o||(o[I]=a++);const te=o[I];r[b]=(r[b]??0)+1;const Y=r[b],P=b===""?"":b+(Y>1?` (${Y})`:""),j=L.querySelector(`.pdf-page-wrapper[data-page="${c}"] .signature-overlays`),C=H[c];if(!j||!C)return;const K=C.scale||1.5,O=X(l,e),R=X(i,e),U=X(d,e),w=X(p,e),B=Ee(C,O,R,U,w,t),S=U*K,y=w*K,m=document.createElement("div");m.className="signature-box-overlay",m.dataset.boxIndex=String(u),m.style.left=B.vpX+"px",m.style.top=B.vpY+"px",m.style.width=Math.max(S,20)+"px",m.style.height=Math.max(y,14)+"px";const N=Ge(te);m.style.borderColor=N.border,m.style.backgroundColor=N.background,m.style.color=N.color,m.style.setProperty("--box-color",N.handle),m.style.transformOrigin="50% 50%",V&&(m.style.transform=`rotate(${h}deg)`);const ae=V?'<span class="rotate-handle" title="Rotate"></span>':"";m.innerHTML=(P?'<span class="overlay-label">'+We(P)+"</span>":"")+ae+'<span class="resize-handle nw" data-handle="nw"></span><span class="resize-handle ne" data-handle="ne"></span><span class="resize-handle sw" data-handle="sw"></span><span class="resize-handle se" data-handle="se"></span>',j.appendChild(m)}),ee!==null){const s=L.querySelector(`.signature-box-overlay[data-box-index="${ee}"]`);s&&s.classList.add("selected")}}function _e(){const e=f.dataset.maxEntries??(ne==null?void 0:ne.dataset.maxEntries)??"";if(e==="")return null;const t=parseInt(e,10);return Number.isNaN(t)?null:t}function xe(){if(!ne)return;const e=_e(),t=f.querySelectorAll(":scope > .signature-box-item").length;e!==null&&t>=e?ne.style.display="none":ne.style.display=""}function we(e,t,n,r,o){const a=_e(),s=f.querySelectorAll(":scope > .signature-box-item").length;if(a!==null&&s>=a){console.log("[PdfSignable] Box add skipped: max_entries reached",{max:a,currentCount:s});return}const u=r??150,c=o??40,l=document.getElementById("signature-boxes-empty");l&&l.classList.add("d-none");const i=f.dataset.prototype??"",d=f.querySelectorAll(":scope > .signature-box-item").length,p=i.replace(/__name__/g,String(d)),g=document.createElement("div");g.innerHTML=p;const h=g.firstElementChild;if(!h)return;h.dataset.index=String(d);const A=h.querySelector(".signature-box-page");A&&(A.value=String(e));const b=H[e],I=Z(),te=me(),Y=u,P=c,j=b?b.scale:1.5,C=b?b.width/j:595,K=b?b.height/j:842;let O,R;switch(te){case"top_left":O=t,R=K-n-P;break;case"top_right":O=C-t-Y,R=K-n-P;break;case"bottom_right":O=C-t-Y,R=n;break;default:O=t,R=n;break}const U=S=>Math.round(S*100)/100,w=h.querySelector(".signature-box-name");for(const S of["x","y","width","height"]){const y=h.querySelector(".signature-box-"+S);y&&(S==="x"?y.value=String(U(k(O,I))):S==="y"?y.value=String(U(k(R,I))):S==="width"?y.value=String(U(k(Y,I))):S==="height"&&(y.value=String(U(k(P,I)))))}const B=h.querySelector(".signature-box-angle");B&&(B.value="0"),w&&(w.value=E.default_box_name),f.appendChild(h),h.scrollIntoView({behavior:"smooth"}),_(),xe(),console.log("[PdfSignable] Box added",{page:e,x:O,y:R,width:u,height:c,unit:I})}Q&&Q.addEventListener("click",()=>Fe());const Ae=document.getElementById("unitBadge"),tt={pt:"pt",mm:"mm",cm:"cm",px:"px",in:"in"};function Ce(){Ae&&(Ae.textContent=tt[Z()]??Z())}Ce();let Oe=Z();if(he&&he.addEventListener("change",()=>{const e=Oe,t=Z();Ce(),f.querySelectorAll(":scope > .signature-box-item").forEach(n=>{for(const r of["x","y","width","height"]){const o=n.querySelector(".signature-box-"+r);if(o!=null&&o.value){const a=parseFloat(o.value);o.value=String(Math.round(k(X(a,e),t)*100)/100)}}}),Oe=t,_()}),f.addEventListener("input",_),f.addEventListener("change",e=>{const t=e.target.closest(".signature-box-item"),n=t==null?void 0:t.querySelector(".signature-box-name");if(n&&e.target===n&&Object.keys(ge).length>0){const r=(n.value??"").trim(),o=r?ge[r]:null;if(o){const a=(s,u)=>{const c=t==null?void 0:t.querySelector(".signature-box-"+s);c&&u!==void 0&&(c.value=String(u))};a("width",o.width),a("height",o.height),a("x",o.x),a("y",o.y),a("angle",o.angle)}}_()}),ye&&ye.addEventListener("change",_),f.addEventListener("click",e=>{if(!e.target.closest(".remove-box"))return;const t=e.target.closest(".signature-box-item");if(t){let n=t;for(;n!=null&&n.parentElement&&n.parentElement!==f;)n=n.parentElement;if(n){const r=Array.from(f.querySelectorAll(":scope > .signature-box-item")).indexOf(n);n.remove(),console.log("[PdfSignable] Box removed",{index:r})}}if(f.querySelectorAll(":scope > .signature-box-item").length===0){const n=document.getElementById("signature-boxes-empty");n&&n.classList.remove("d-none")}_(),xe()}),D){let e,t=!1,n=0;new ResizeObserver(()=>{if(t)return;const o=(D==null?void 0:D.clientWidth)??0;Math.abs(o-n)<10||(n=o,clearTimeout(e),e=setTimeout(async()=>{if(!(!z||L.style.display==="none")&&!t){t=!0;try{const a=await Be();L.innerHTML="",Object.keys(H).forEach(s=>delete H[Number(s)]);for(let s=1;s<=z.numPages;s++){se&&await se;const u=await z.getPage(s),c=u.getViewport({scale:a});H[s]=c;const l=document.createElement("div");l.className="pdf-page-wrapper",l.dataset.page=String(s);const i=document.createElement("canvas"),d=i.getContext("2d");if(!d)continue;i.height=c.height,i.width=c.width,i.dataset.page=String(s);const p=document.createElement("div");p.className="signature-overlays",l.appendChild(i),l.appendChild(p),se=u.render({canvasContext:d,viewport:c}).promise,await se,L.appendChild(l)}_(),D&&(n=D.clientWidth)}finally{t=!1}}},200))}).observe(D)}function Te(){var e;(e=J==null?void 0:J.value)!=null&&e.trim()&&(console.log("[PdfSignable] Auto-loading PDF (preset URL)"),Fe())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Te):Te(),L.addEventListener("click",e=>{if(e.target.closest(".signature-box-overlay"))return;ve(null);const t=e.target.closest(".pdf-page-wrapper"),n=t==null?void 0:t.querySelector("canvas");if(!n||!z)return;const r=parseInt(n.dataset.page??"1",10),o=H[r];if(!o)return;const a=n.getBoundingClientRect(),s=n.width/a.width,u=n.height/a.height,c=(e.clientX-a.left)*s,l=(e.clientY-a.top)*u,i=40,d=i*(o.scale||1.5),p=o.convertToPdfPoint(c,l+d);we(r,p[0],p[1],150,i)});function nt(e,t){if(e.page!==t.page)return!1;const n=e.x+e.w,r=t.x+t.w,o=e.y+e.h,a=t.y+t.h;return e.x<r&&t.x<n&&e.y<a&&t.y<o}function ke(){const e=f.querySelectorAll(":scope > .signature-box-item"),t=[];return e.forEach(n=>{var l,i,d,p;const r=n.querySelector(".signature-box-page"),o=parseInt((r==null?void 0:r.value)??"1",10),a=parseFloat(((l=n.querySelector(".signature-box-x"))==null?void 0:l.value)??"0"),s=parseFloat(((i=n.querySelector(".signature-box-y"))==null?void 0:i.value)??"0"),u=parseFloat(((d=n.querySelector(".signature-box-width"))==null?void 0:d.value)??"150"),c=parseFloat(((p=n.querySelector(".signature-box-height"))==null?void 0:p.value)??"40");t.push({page:o,x:a,y:s,w:u,h:c})}),t}function ot(e,t){const n=H[e];if(!n)return[];const r=Z(),o=me(),a=n.scale||1.5,s=ke(),u=[];return s.forEach((c,l)=>{if(l===t||c.page!==e)return;const i=X(c.x,r),d=X(c.y,r),p=X(c.w,r),g=X(c.h,r),{vpX:h,vpY:A}=Ee(n,i,d,p,g,o);u.push({left:h,top:A,right:h+p*a,bottom:A+g*a})}),u}let M=null,ee=null;function ve(e){if(ee=e,L.querySelectorAll(".signature-box-overlay.selected").forEach(t=>t.classList.remove("selected")),e!==null){const t=L.querySelector(`.signature-box-overlay[data-box-index="${e}"]`);t&&t.classList.add("selected")}}let be=null;function Xe(e){if(!be)return;const{overlay:t,item:n,centerX:r,centerY:o,startAngle:a,startMouseAngle:s}=be;let c=(Math.atan2(e.clientY-o,e.clientX-r)-s)*180/Math.PI,l=a+c;for(;l>180;)l-=360;for(;l<-180;)l+=360;const i=n.querySelector(".signature-box-angle");i&&(i.value=String(Math.round(l*100)/100)),t.style.transform=`rotate(${l}deg)`}function De(){be&&(document.removeEventListener("mousemove",Xe),document.removeEventListener("mouseup",De),be=null)}function st(e){var I,te;const t=e.target.closest(".signature-box-overlay");if(!((I=t==null?void 0:t.dataset)!=null&&I.boxIndex))return;e.preventDefault(),e.stopPropagation();const n=e.target.closest(".rotate-handle");if(V&&n){const Y=parseInt(t.dataset.boxIndex,10),P=f.querySelectorAll(":scope > .signature-box-item")[Y];if(!P)return;const j=P.querySelector(".signature-box-angle");if(!j)return;const C=t.getBoundingClientRect(),K=C.left+C.width/2,O=C.top+C.height/2,R=parseFloat(j.value)||0,U=Math.atan2(e.clientY-O,e.clientX-K);be={overlay:t,item:P,centerX:K,centerY:O,startAngle:R,startMouseAngle:U},document.addEventListener("mousemove",Xe),document.addEventListener("mouseup",De);return}const r=e.target.closest(".resize-handle"),o=parseInt(t.dataset.boxIndex,10),a=f.querySelectorAll(":scope > .signature-box-item")[o];if(!a)return;const s=t.closest(".pdf-page-wrapper"),u=parseInt(((te=s==null?void 0:s.dataset)==null?void 0:te.page)??"1",10),c=H[u];if(!c)return;const l=parseFloat(t.style.width)||20,i=parseFloat(t.style.height)||14,d=parseFloat(t.style.left)||0,p=parseFloat(t.style.top)||0,g=a.querySelector(".signature-box-x"),h=a.querySelector(".signature-box-y"),A=a.querySelector(".signature-box-width"),b=a.querySelector(".signature-box-height");M={mode:r?"resize":"move",handle:r?r.dataset.handle??null:null,overlay:t,item:a,boxIndex:o,viewport:c,startX:e.clientX,startY:e.clientY,startLeft:d,startTop:p,startRight:d+l,startBottom:p+i,startFormX:g&&parseFloat(g.value)||0,startFormY:h&&parseFloat(h.value)||0,startFormW:A&&parseFloat(A.value)||150,startFormH:b&&parseFloat(b.value)||40},t.classList.add("dragging"),Me=!0,M.mode==="move"&&ve(o),document.addEventListener("mousemove",He),document.addEventListener("mouseup",Ye)}function He(e){var R,U;if(!M)return;const{overlay:t,viewport:n,startLeft:r,startTop:o,startRight:a,startBottom:s}=M,u=(e.clientX-M.startX)/ue,c=(e.clientY-M.startY)/ue,l=20;let i,d,p,g;if(M.mode==="move")i=Math.max(0,Math.min(n.width-(a-r),r+u)),d=Math.max(0,Math.min(n.height-(s-o),o+c)),p=a-r,g=s-o;else{const w=M.handle;let B=r,S=o,y=a,m=s;w==="se"?(y=Math.min(n.width,Math.max(r+l,a+u)),m=Math.min(n.height,Math.max(o+l,s+c))):w==="sw"?(B=Math.max(0,Math.min(a-l,r+u)),m=Math.min(n.height,Math.max(o+l,s+c))):w==="ne"?(y=Math.min(n.width,Math.max(r+l,a+u)),S=Math.max(0,Math.min(s-l,o+c))):w==="nw"&&(B=Math.max(0,Math.min(a-l,r+u)),S=Math.max(0,Math.min(s-l,o+c))),i=B,d=S,p=y-B,g=m-S}const h=n.scale||1.5,A=parseInt(((U=(R=t.closest(".pdf-page-wrapper"))==null?void 0:R.dataset)==null?void 0:U.page)??"1",10);if(q>0){const w=p/h,B=g/h,S=Pe(n,i,d,w,B,me()),y=Z();let m=k(S.xPt,y),N=k(S.yPt,y),ae=k(w,y),re=k(B,y);m=Math.round(m/q)*q,N=Math.round(N/q)*q,ae=Math.round(ae/q)*q,re=Math.max(q,Math.round(re/q)*q);const de=X(m,y),fe=X(N,y),T=X(ae,y),pe=X(re,y),Se=Ee(n,de,fe,T,pe,me());i=Se.vpX,d=Se.vpY,p=T*h,g=pe*h}if(le){const w=ot(A,M.boxIndex),B=i+p,S=d+g,y=w.flatMap(T=>[T.left,T.right]),m=w.flatMap(T=>[T.top,T.bottom]),N=(T,pe)=>{let Se=T,Re=ie;for(const Ne of pe){const $e=Math.abs(T-Ne);$e<Re&&(Re=$e,Se=Ne)}return Se},ae=N(i,y),re=N(B,y),de=N(d,m),fe=N(S,m);i=ae,d=de,p=Math.max(l,re-ae),g=Math.max(l,fe-de)}t.style.left=i+"px",t.style.top=d+"px",t.style.width=p+"px",t.style.height=g+"px";const b=p/h,I=g/h,te=Pe(n,i,d,b,I,me()),Y=Z(),P=w=>Math.round(w*100)/100,j=M.item.querySelector(".signature-box-x"),C=M.item.querySelector(".signature-box-y"),K=M.item.querySelector(".signature-box-width"),O=M.item.querySelector(".signature-box-height");j&&(j.value=String(P(k(te.xPt,Y)))),C&&(C.value=String(P(k(te.yPt,Y)))),K&&(K.value=String(P(k(b,Y)))),O&&(O.value=String(P(k(I,Y))))}function Ye(){if(!M)return;const e=M;if(M.overlay.classList.remove("dragging"),Me=!1,document.removeEventListener("mousemove",He),document.removeEventListener("mouseup",Ye),W){const t=ke(),n=t[e.boxIndex];if(n&&t.some((o,a)=>a!==e.boxIndex&&nt(n,o))){const o=i=>Math.round(i*100)/100,a=e.item.querySelector(".signature-box-x"),s=e.item.querySelector(".signature-box-y"),u=e.item.querySelector(".signature-box-width"),c=e.item.querySelector(".signature-box-height");a&&(a.value=String(o(e.startFormX))),s&&(s.value=String(o(e.startFormY))),u&&(u.value=String(o(e.startFormW))),c&&(c.value=String(o(e.startFormH)));const l=E.no_overlap_message??"Signature boxes on the same page cannot overlap.";alert(l)}}M=null,_()}L.addEventListener("mousedown",st),ne&&ne.addEventListener("click",()=>we(1,0,0)),xe(),$.addEventListener("keydown",e=>{const t=e.target;if(!(t!=null&&t.closest("input, select, textarea"))){if(e.ctrlKey&&e.key==="z"){e.preventDefault();const n=f.querySelectorAll(":scope > .signature-box-item");if(n.length>0){const r=n[n.length-1],o=Array.from(f.querySelectorAll(":scope > .signature-box-item")).indexOf(r);if(r.remove(),ee===o?ve(null):ee!==null&&ee>o&&ve(ee-1),f.querySelectorAll(":scope > .signature-box-item").length===0){const a=document.getElementById("signature-boxes-empty");a&&a.classList.remove("d-none")}_(),xe()}return}if(e.key==="Delete"||e.key==="Backspace"){if(ee===null)return;const r=f.querySelectorAll(":scope > .signature-box-item")[ee];if(r){if(e.preventDefault(),r.remove(),ve(null),f.querySelectorAll(":scope > .signature-box-item").length===0){const o=document.getElementById("signature-boxes-empty");o&&o.classList.remove("d-none")}_(),xe()}return}if(e.ctrlKey&&e.shiftKey&&e.key.toLowerCase()==="a"){if(e.preventDefault(),!z)return;const n=1,r=H[n];if(r){const o=r.scale||1.5,a=r.width/o,s=r.height/o;we(n,(a-150)/2,(s-40)/2,150,40)}else we(1,0,0)}}}),$.addEventListener("submit",e=>{e.preventDefault(),f.querySelectorAll(":scope > .signature-box-item").forEach((n,r)=>{n.querySelectorAll("input, select, textarea").forEach(o=>{o.name=o.name.replace(/(\])\[\d+\](\[)/,`$1[${r}]$2`)})}),$.submit()})}Je()})();
